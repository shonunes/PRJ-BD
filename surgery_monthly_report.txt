WITH monthly_surgeries AS (
    SELECT
        doctor_id,
        DATE_TRUNC('month', date) AS surgery_month,
        COUNT(surgery_id) AS surgery_count
    FROM surgeries
    WHERE date >= (CURRENT_DATE - INTERVAL '1 year')
    GROUP BY doctor_id, DATE_TRUNC('month', date)
),
ranked_surgeries AS (
    SELECT
        doctor_id,
        surgery_month,
        surgery_count,
        RANK() OVER (PARTITION BY surgery_month ORDER BY surgery_count DESC) AS rank
    FROM monthly_surgeries
)
SELECT
    surgery_month,
    doctor_id,
    surgery_count
FROM ranked_surgeries
WHERE rank = 1
ORDER BY surgery_month;
